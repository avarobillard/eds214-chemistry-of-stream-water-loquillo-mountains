---
title: "paper"
format: html
---

# Background
```{r}
#calling libraries
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
library(patchwork)
library(zoo)

#sourcing the moving average function for analysis of the data 
source(here("R", "moving-average-function.R"))
```


# Data
```{r}
#read in data
bq1_data <- read_csv(here::here("data", "QuebradaCuenca1-Bisley.csv"))

bq2_data <- read_csv(here::here("data", "QuebradaCuenca2-Bisley.csv"))

bq3_data <- read_csv(here::here("data", "QuebradaCuenca3-Bisley.csv"))

prm_data <- read_csv(here::here("data", "RioMameyesPuenteRoto.csv"))

#join data frames
compiled_data <- rbind(bq1_data, bq2_data, bq3_data, prm_data)

#clean names for easier reference to names
compiled_data <- compiled_data |> clean_names()

#filter data for necessary columns 
compiled_data <- compiled_data |> 
  select(sample_id, sample_date, k, na, mg, ca, nh4_n) |> 
  filter(sample_date >= "1988-01-05",
         sample_date <= "1994-12-27")
```

# Methods
```{r}
#calculate 9 day moving average 
compiled_data$mov_avg_k <- sapply(X = compiled_data$sample_date,
                                  FUN = moving_average,
                                  sample_date = compiled_data$sample_date,
                                  nutrient_conc = compiled_data$k,
                                  win_size_wks = 9
)

#calculating 9 day moving average using mutate and group by
mov_avg_k <- compiled_data |> 
  group_by(sample_id) |> 
  mutate(mov_avg_k = sapply(sample_date, 
                            moving_average, 
                            sample_date = sample_date, 
                            nutrient_conc = k, 
                            win_size_wks = 9)) |> 
  select(sample_id, sample_date, k, mov_avg_k)
```

# Results
```{r}
# ggplot of the rollmean average 
ggplot(data = mov_avg_k, aes(x = sample_date, y = mov_avg_k)) +
  geom_line() +
  labs(x = "Years",
       y = "K mg |-1")
```

